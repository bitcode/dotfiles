---
# Desktop Layout Backup Manifest
# Generated by Dotsible macOS Enterprise Management

backup_info:
  timestamp: "{{ backup_info.timestamp }}"
  hostname: "{{ backup_info.hostname }}"
  user: "{{ backup_info.user }}"
  macos_version: "{{ backup_info.macos_version }}"
  backup_type: "{{ backup_info.backup_type | default('manual') }}"
  dotsible_version: "{{ dotsible.version | default('2.0.0') }}"

backup_files:
{% for file_result in backup_info.backup_files %}
{% if file_result.changed %}
  - source: "{{ file_result.item.item.path }}"
    destination: "{{ file_result.dest }}"
    description: "{{ file_result.item.item.description }}"
    backup_key: "{{ file_result.item.item.backup_key }}"
    size: "{{ file_result.size | default('unknown') }}"
{% endif %}
{% endfor %}

plist_files:
{% for plist in macos_enterprise.desktop_layout.plist_files %}
  - path: "{{ plist.path }}"
    description: "{{ plist.description }}"
    backup_key: "{{ plist.backup_key }}"
    backup_file: "{{ plist.backup_key }}.plist"
{% endfor %}

preserved_settings:
{% for setting in macos_enterprise.desktop_layout.preserve_settings %}
  - "{{ setting }}"
{% endfor %}

system_info:
  architecture: "{{ ansible_architecture }}"
  kernel: "{{ ansible_kernel }}"
  python_version: "{{ ansible_python_version }}"
  
restore_instructions: |
  To restore this desktop layout:
  
  1. Using Ansible:
     ansible-playbook site.yml -e "macos_restore_desktop_layout=true macos_desktop_backup_timestamp={{ backup_info.timestamp | regex_replace('[^0-9T]', '') }}"
  
  2. Using command line:
     dotsible-restore-desktop {{ backup_info.timestamp | regex_replace('[^0-9T]', '') }}
  
  3. Using the latest backup:
     dotsible-restore-desktop latest

notes: |
  This backup contains:
  - Desktop icon positions and arrangements
  - Finder view preferences and settings
  - Dock configuration
  - Global system preferences related to desktop layout
  
  The backup does not include:
  - Application data or documents
  - User account settings
  - Network or security configurations
  - System-level preferences (if MDM is detected)

compatibility:
  minimum_macos_version: "10.15"
  recommended_restore_environment: "same_user_same_hostname"
  cross_user_restore: "possible_with_manual_adjustment"
  cross_hostname_restore: "possible_with_manual_adjustment"
