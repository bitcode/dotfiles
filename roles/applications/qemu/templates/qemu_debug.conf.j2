# QEMU Debugging Configuration
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

[debugging]
# GDB integration
gdb_enabled = true
gdb_port = 1234
gdb_wait_for_connection = true

# Monitor interface
monitor_enabled = true
monitor_port = 4444

# Logging
log_enabled = true
log_level = debug
log_file = {{ qemu_paths.config_dir }}/qemu-debug.log

# Debugging options for each architecture
{% for arch in qemu_config.architectures %}
[debug_{{ arch }}]
gdb_port = {{ 1234 + loop.index0 }}
monitor_port = {{ 4444 + loop.index0 }}
log_file = {{ qemu_paths.config_dir }}/qemu-debug-{{ arch }}.log

# Architecture-specific debugging settings
{% if arch == 'arm64' %}
cpu_features = +gdb
machine_debug = on
{% elif arch == 'arm32' %}
cpu_features = +gdb
machine_debug = on
{% elif arch == 'x86_64' %}
cpu_features = +gdb
machine_debug = on
{% elif arch in ['riscv64', 'riscv32'] %}
cpu_features = +gdb
machine_debug = on
{% endif %}

{% endfor %}

[gdb_integration]
# GDB startup commands
startup_commands = [
    "set architecture {{ ansible_architecture }}",
    "target remote localhost:1234",
    "set confirm off",
    "set pagination off"
]

# Breakpoint settings
auto_breakpoints = [
    "_start",
    "main"
]

# Memory layout debugging
memory_regions = true
register_display = true
disassembly_flavor = intel