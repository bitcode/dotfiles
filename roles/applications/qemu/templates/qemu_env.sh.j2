#!/bin/bash
# QEMU Environment Configuration
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

# QEMU paths
export QEMU_CONFIG_DIR="{{ qemu_paths.config_dir }}"
export QEMU_SCRIPTS_DIR="{{ qemu_paths.scripts_dir }}"
export QEMU_EXAMPLES_DIR="{{ qemu_paths.examples_dir }}"

# Add QEMU scripts to PATH
export PATH="${QEMU_SCRIPTS_DIR}:${PATH}"

# QEMU system emulators
{% for arch, emulator in qemu_config.system_emulators.items() %}
export QEMU_SYSTEM_{{ arch.upper() }}="{{ emulator }}"
{% endfor %}

# QEMU user emulators
{% for arch, emulator in qemu_config.user_emulators.items() %}
export QEMU_USER_{{ arch.upper() }}="{{ emulator }}"
{% endfor %}

# Default memory sizes
{% for arch in qemu_config.architectures %}
export QEMU_MEMORY_{{ arch.upper() }}="{{ qemu_config.default_memory[arch] }}"
{% endfor %}

# Common QEMU options
export QEMU_COMMON_OPTS="{{ qemu_config.common_options | join(' ') }}"
export QEMU_GDB_OPTS="{{ qemu_config.gdb_options | join(' ') }}"

# Platform-specific acceleration
{% if ansible_os_family == "Darwin" %}
export QEMU_ACCEL_OPTS="{{ qemu_macos_options.hvf_acceleration | join(' ') }}"
{% else %}
export QEMU_ACCEL_OPTS="{{ qemu_debian_options.kvm_acceleration | default(qemu_archlinux_options.kvm_acceleration) | join(' ') }}"
{% endif %}

# QEMU helper functions
qemu_status() {
    echo "QEMU Environment Status:"
    echo "========================"
    echo "Config Dir: ${QEMU_CONFIG_DIR}"
    echo "Scripts Dir: ${QEMU_SCRIPTS_DIR}"
    echo "Examples Dir: ${QEMU_EXAMPLES_DIR}"
    echo ""
    echo "Available System Emulators:"
{% for arch, emulator in qemu_config.system_emulators.items() %}
    command -v {{ emulator }} >/dev/null 2>&1 && echo "  ✓ {{ arch }}: {{ emulator }}" || echo "  ✗ {{ arch }}: {{ emulator }} (not found)"
{% endfor %}
    echo ""
    echo "Available User Emulators:"
{% for arch, emulator in qemu_config.user_emulators.items() %}
    command -v {{ emulator }} >/dev/null 2>&1 && echo "  ✓ {{ arch }}: {{ emulator }}" || echo "  ✗ {{ arch }}: {{ emulator }} (not found)"
{% endfor %}
}

qemu_help() {
    echo "QEMU Helper Commands:"
    echo "===================="
    echo "qemu_status          - Show QEMU environment status"
    echo "qemu-<arch>          - Launch QEMU system emulator for architecture"
    echo "qemu-debug-<arch>    - Launch QEMU with GDB debugging enabled"
    echo "qemu-user-<arch>     - Launch QEMU user emulator for architecture"
    echo "qemu-manager         - Interactive QEMU management tool"
    echo ""
    echo "Available architectures: {{ qemu_config.architectures | join(', ') }}"
}

# Aliases for convenience
alias qemu-status='qemu_status'
alias qemu-help='qemu_help'