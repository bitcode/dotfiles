# GPU Environment Configuration for Alacritty
# Auto-generated by Ansible for {{ ansible_hostname }}
# Generated: {{ ansible_date_time.iso8601 }}
#
# This file contains the optimal GPU environment configuration
# for Alacritty based on detected hardware.
#
# System Information:
# - Hostname: {{ ansible_hostname }}
# - OS: {{ ansible_distribution }} {{ ansible_distribution_version }}
# - Architecture: {{ ansible_architecture }}
# - GPUs Detected: {{ gpu_info.count }}
{% if gpu_info.nvidia_detected %}
# - NVIDIA GPU: {{ gpu_info.nvidia_model }}
{% endif %}
{% if gpu_info.amd_detected %}
# - AMD GPU: {{ gpu_info.amd_model }}
{% endif %}
{% if gpu_info.intel_detected %}
# - Intel GPU: {{ gpu_info.intel_model }}
{% endif %}
#
# Configuration Details:
# - System Type: {{ alacritty_gpu_config.system_type }}
# - Optimal Driver: {{ alacritty_gpu_config.optimal_driver }}
# - Rationale: {{ alacritty_gpu_config.rationale }}

# Primary MESA driver override
{% if alacritty_gpu_config.mesa_loader_override %}
MESA_LOADER_DRIVER_OVERRIDE={{ alacritty_gpu_config.mesa_loader_override }}
{% else %}
# No MESA driver override needed (using default)
{% endif %}

# Additional environment variables for stability
{% for key, value in alacritty_gpu_config.additional_env_vars.items() %}
{% if value %}
{{ key }}={{ value }}
{% endif %}
{% endfor %}

# Multi-GPU system optimizations
{% if (gpu_info.count | int) > 1 %}
# Multi-GPU system detected - additional stability settings
MESA_GLSL_CACHE_DISABLE=1
MESA_GLTHREAD=false

{% if gpu_info.amd_detected and gpu_info.nvidia_detected %}
# Dual GPU (AMD + NVIDIA) - prefer AMD for better MESA compatibility
DRI_PRIME=1
{% endif %}
{% endif %}

# Usage Instructions:
# 1. Source this file before launching Alacritty:
#    source {{ ansible_user_dir }}/.config/alacritty/gpu-env.conf && alacritty
#
# 2. Use the GPU-optimized launcher script:
#    {{ ansible_user_dir }}/.local/bin/alacritty-gpu
#
# 3. Use the desktop entry for GUI launches:
#    Applications â†’ Alacritty (GPU Optimized)
#
# 4. For debugging, set ALACRITTY_GPU_DEBUG=1:
#    ALACRITTY_GPU_DEBUG=1 {{ ansible_user_dir }}/.local/bin/alacritty-gpu

# Validation Commands:
# Test the configuration:
#   source {{ ansible_user_dir }}/.config/alacritty/gpu-env.conf && glxinfo | grep "OpenGL renderer"
#
# Check available drivers:
#   ls /usr/lib/dri/
#
# Test Alacritty launch:
#   source {{ ansible_user_dir }}/.config/alacritty/gpu-env.conf && alacritty --version
